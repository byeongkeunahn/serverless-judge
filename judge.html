<!DOCTYPE html>
<html>
  <head>
    <title>Serverless Judge</title>
    <script src="lib/codemirror/codemirror.min.js"></script>
    <script src="lib/codemirror/python.min.js"></script>
    <script src="lib/codemirror/clike.min.js"></script>
    <link rel="stylesheet" href="lib/codemirror/codemirror.min.css">
    <style>
      .CodeMirror { border: 2px solid orange }
      .CodeMirror-focused { border: 2px solid blue }
    </style>
    <script type="module" src="./lib/runner.js"></script>
    <script type="module" src="./lib/judge.js"></script>
	<script type="module">
      async function run() {
        document.querySelector('#verdict').value = "RUNNING. PLEASE WAIT...\n\n" + document.querySelector('#verdict').value;
        const language = document.querySelector('#language').value;
        const solution_src = myCodeMirror.getValue();
		window.judgeSolution(language, solution_src, window.manifest).then(
		  result => document.querySelector('#verdict').value = JSON.stringify(result)
		);
      }
	  const manifest = new URLSearchParams(window.location.search).get('manifest');
	  fetch(manifest)
	  .then(res => res.json())
	  .then(out => { window.manifest = out; })
      .catch(err => { throw err });
      document.querySelector('#run').addEventListener('click', async() => { await run(); });
    </script>
    <script>
      var myCodeMirror;
      window.onload = function() {
        myCodeMirror = CodeMirror.fromTextArea(
          document.querySelector('#solution_src'), {
            mode: "python",
            lineNumbers: true,
            content: document.querySelector('#solution_src').value
          }
        );
        document.querySelector('#language').onchange = function() {
          const language = document.querySelector('#language').value;
          const mode = language == "python3" ? "python" : "text/x-c++src";
          myCodeMirror.setOption("mode", mode);
        };
      };
    </script>
  </head>
  <body>
    <h1>Serverless Judge</h1>
    Language:
	<select id="language">
      <option value="python3">Python 3</option>
      <option value="cpp">C++</option>
    </select><br>
    Source code:<br>
    <textarea id="solution_src" cols="100" rows="10"></textarea><br>
    <button id="run">Judge it!</button><br><br>
    Judge result:<br>
    <textarea id="verdict" cols="100" rows="10" readonly></textarea><br><br>
  </body>
</html>